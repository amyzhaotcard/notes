<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>setState | 知食</title>
  <meta name="generator" content="VuePress 1.8.2">
  <link rel="icon" href="/notes/logo-2.jpeg">
  <meta name="description" content="拾柒">
  
  <link rel="preload" href="/notes/assets/css/0.styles.24ba112b.css" as="style"><link rel="preload" href="/notes/assets/js/app.9a2b2637.js" as="script"><link rel="preload" href="/notes/assets/js/2.d2004554.js" as="script"><link rel="preload" href="/notes/assets/js/8.e6f27235.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.89976a0c.js"><link rel="prefetch" href="/notes/assets/js/11.fb7d2f50.js"><link rel="prefetch" href="/notes/assets/js/12.465a626e.js"><link rel="prefetch" href="/notes/assets/js/13.5defd018.js"><link rel="prefetch" href="/notes/assets/js/14.2d05555b.js"><link rel="prefetch" href="/notes/assets/js/15.71e15746.js"><link rel="prefetch" href="/notes/assets/js/16.0176a1aa.js"><link rel="prefetch" href="/notes/assets/js/17.a2264bc5.js"><link rel="prefetch" href="/notes/assets/js/18.135e86c2.js"><link rel="prefetch" href="/notes/assets/js/19.c99d1b49.js"><link rel="prefetch" href="/notes/assets/js/20.162f13e9.js"><link rel="prefetch" href="/notes/assets/js/21.1782a9fc.js"><link rel="prefetch" href="/notes/assets/js/22.0c434d70.js"><link rel="prefetch" href="/notes/assets/js/23.dfac21e1.js"><link rel="prefetch" href="/notes/assets/js/24.6bab2023.js"><link rel="prefetch" href="/notes/assets/js/25.fbe6cc96.js"><link rel="prefetch" href="/notes/assets/js/26.ade12aa9.js"><link rel="prefetch" href="/notes/assets/js/27.dfa3a4be.js"><link rel="prefetch" href="/notes/assets/js/28.001c4f04.js"><link rel="prefetch" href="/notes/assets/js/29.c55ba6fd.js"><link rel="prefetch" href="/notes/assets/js/3.a1ef97ad.js"><link rel="prefetch" href="/notes/assets/js/30.3e8a91fb.js"><link rel="prefetch" href="/notes/assets/js/31.17afa1ef.js"><link rel="prefetch" href="/notes/assets/js/32.22e67e41.js"><link rel="prefetch" href="/notes/assets/js/33.767979c9.js"><link rel="prefetch" href="/notes/assets/js/34.52ba1158.js"><link rel="prefetch" href="/notes/assets/js/35.3fd887c5.js"><link rel="prefetch" href="/notes/assets/js/36.96d13f7b.js"><link rel="prefetch" href="/notes/assets/js/37.2b546fd4.js"><link rel="prefetch" href="/notes/assets/js/38.ec4c756b.js"><link rel="prefetch" href="/notes/assets/js/39.97ddf949.js"><link rel="prefetch" href="/notes/assets/js/4.a3afc636.js"><link rel="prefetch" href="/notes/assets/js/40.c68fd8b8.js"><link rel="prefetch" href="/notes/assets/js/41.50c8fe30.js"><link rel="prefetch" href="/notes/assets/js/42.236bae5b.js"><link rel="prefetch" href="/notes/assets/js/43.2dfbf8c8.js"><link rel="prefetch" href="/notes/assets/js/44.f6766569.js"><link rel="prefetch" href="/notes/assets/js/45.4200ad0a.js"><link rel="prefetch" href="/notes/assets/js/46.a584a5ae.js"><link rel="prefetch" href="/notes/assets/js/47.22948184.js"><link rel="prefetch" href="/notes/assets/js/48.9266e070.js"><link rel="prefetch" href="/notes/assets/js/49.ba043bc1.js"><link rel="prefetch" href="/notes/assets/js/5.af226d31.js"><link rel="prefetch" href="/notes/assets/js/50.2ba155e0.js"><link rel="prefetch" href="/notes/assets/js/51.19c00fd6.js"><link rel="prefetch" href="/notes/assets/js/52.eb37dace.js"><link rel="prefetch" href="/notes/assets/js/53.4cfd4a88.js"><link rel="prefetch" href="/notes/assets/js/54.ecc01324.js"><link rel="prefetch" href="/notes/assets/js/55.26b65c60.js"><link rel="prefetch" href="/notes/assets/js/56.3e420ef5.js"><link rel="prefetch" href="/notes/assets/js/57.f0a4d417.js"><link rel="prefetch" href="/notes/assets/js/58.d39eb5a9.js"><link rel="prefetch" href="/notes/assets/js/59.31a19376.js"><link rel="prefetch" href="/notes/assets/js/6.41739131.js"><link rel="prefetch" href="/notes/assets/js/60.48436d35.js"><link rel="prefetch" href="/notes/assets/js/61.9d16e07b.js"><link rel="prefetch" href="/notes/assets/js/62.394804b2.js"><link rel="prefetch" href="/notes/assets/js/63.79c8129f.js"><link rel="prefetch" href="/notes/assets/js/64.a151be2c.js"><link rel="prefetch" href="/notes/assets/js/65.20978ef7.js"><link rel="prefetch" href="/notes/assets/js/66.77300fb9.js"><link rel="prefetch" href="/notes/assets/js/67.106b440b.js"><link rel="prefetch" href="/notes/assets/js/68.68a10217.js"><link rel="prefetch" href="/notes/assets/js/69.51188dc1.js"><link rel="prefetch" href="/notes/assets/js/7.32f6ebde.js"><link rel="prefetch" href="/notes/assets/js/70.e0faed62.js"><link rel="prefetch" href="/notes/assets/js/71.a0b88879.js"><link rel="prefetch" href="/notes/assets/js/72.33941746.js"><link rel="prefetch" href="/notes/assets/js/73.c848ed41.js"><link rel="prefetch" href="/notes/assets/js/74.071f90a0.js"><link rel="prefetch" href="/notes/assets/js/75.ea94353e.js"><link rel="prefetch" href="/notes/assets/js/76.0e680c67.js"><link rel="prefetch" href="/notes/assets/js/77.3a5375a5.js"><link rel="prefetch" href="/notes/assets/js/78.572fa119.js"><link rel="prefetch" href="/notes/assets/js/79.ea9d582d.js"><link rel="prefetch" href="/notes/assets/js/80.968b9125.js"><link rel="prefetch" href="/notes/assets/js/81.40176e24.js"><link rel="prefetch" href="/notes/assets/js/82.b633a738.js"><link rel="prefetch" href="/notes/assets/js/83.9d2d0246.js"><link rel="prefetch" href="/notes/assets/js/84.620ce32d.js"><link rel="prefetch" href="/notes/assets/js/85.c1c1146d.js"><link rel="prefetch" href="/notes/assets/js/9.c8a9c055.js">
  <link rel="stylesheet" href="/notes/assets/css/0.styles.24ba112b.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">知食</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/notes/js" class="sidebar-heading clickable"><span>JS相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/vue" class="sidebar-heading clickable"><span>VUE相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/react" class="sidebar-heading clickable router-link-active open"><span>React相关</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/react/生命周期.html" class="sidebar-link">react 的生命周期</a></li><li><a href="/notes/react/setState.html" aria-current="page" class="active sidebar-link">setState</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/react/setState.html#setstate-是同步还是异步" class="sidebar-link">setState 是同步还是异步？</a></li><li class="sidebar-sub-header"><a href="/notes/react/setState.html#调用-setstate-之后发生了什么" class="sidebar-link">调用 setstate 之后发生了什么？</a></li></ul></li><li><a href="/notes/react/调用super的目的.html" class="sidebar-link">(在构造函数中)调用 super(props) 的目的是什么?</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/css" class="sidebar-heading clickable"><span>CSS相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/打包相关" class="sidebar-heading clickable"><span>打包相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/网络" class="sidebar-heading clickable"><span>网络相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/其他" class="sidebar-heading clickable"><span>其他</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/面经" class="sidebar-heading clickable"><span>面经</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/mianshi" class="sidebar-heading clickable"><span>面试</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="setstate"><a href="#setstate" class="header-anchor">#</a> setState</h1> <h2 id="setstate-是同步还是异步"><a href="#setstate-是同步还是异步" class="header-anchor">#</a> setState 是同步还是异步？</h2> <blockquote><p>setState 本身并不是异步，只是因为 react 的性能优化机制体现为异步。在 react 的生命周期函数或者合成事件下为异步，在 DOM 原生事件下以及 setTimeOut 为同步。</p></blockquote> <h4 id="为什么在-react-的生命周期函数或者作用域下为异步"><a href="#为什么在-react-的生命周期函数或者作用域下为异步" class="header-anchor">#</a> 为什么在 react 的生命周期函数或者作用域下为异步?</h4> <p>在 state 中定义一个值，在 componentDidMount 中 setState 改变这个值，如：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      number<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> number<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>此时的打印结果为 1，从表象上看，像是异步的操作， 但其实只是异步的表现形式，每次调用 setState 都会触发更新，异步操作是为了提高性能，将多个状态合并一起更新，减少重新 render 的次数。如果在一个循环中 setState，在同步机制下，就会重复渲染，消耗性能，所以 react 会将多个 setState 合并为一个执行，当执行 setState 时，state 中的数据不会立马更新。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> number<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>打印结果：</p> <img src="data:image/png;base64,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" width="600"> <h4 id="如何同步的获取到更新后的数据"><a href="#如何同步的获取到更新后的数据" class="header-anchor">#</a> 如何同步的获取到更新后的数据？</h4> <p>通过回调函数</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> number<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="为什么-settimeout-可以将-setstate-的执行顺序从异步变为同步"><a href="#为什么-settimeout-可以将-setstate-的执行顺序从异步变为同步" class="header-anchor">#</a> 为什么 setTimeout 可以将 setState 的执行顺序从异步变为同步？</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> number<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>并不是 setTimeout 改变了 setState，而是 setTimeout 帮助 setState “逃脱”了 React 对它的管控。只要是在 React 管控下的 setState，一定是异步的。</p> <p>setState 工作流为：</p> <img src="/notes/assets/img/setState2.b355ca24.png" width="600"> <p>isBatchingUpdates 是一个 react 全局唯一的变量，初始值是 false，意味着“当前并未进行任何批量更新操作”，每当 React 去执行更新动作时，会将 isBatchingUpdates 置为 true，表示现在正处于批量更新过程中。置为 true 时，任何需要更新的组件都只能暂时进入 dirtyComponents 里排队等候下一次的批量更新。
isBatchingUpdates 这个变量，在 React 的生命周期函数以及合成事件执行前，已经被 React 悄悄修改为了 true，这时我们所做的 setState 操作自然不会立即生效。当函数执行完毕后，事务的 close 方法会再把 isBatchingUpdates 改为 false。
因为 isBatchingUpdates 是在同步代码中变化的，而 setTimeout 的逻辑是异步执行的。当 this.setState 调用真正发生的时候，isBatchingUpdates 早已经被重置为了 false，这就使得当前场景下的 setState 具备了立刻发起同步更新的能力。</p> <h4 id="为什么在原生-dom-操作中也是同步的"><a href="#为什么在原生-dom-操作中也是同步的" class="header-anchor">#</a> 为什么在原生 DOM 操作中也是同步的？</h4> <p>原生 js 绑定的事件，不受 react 的控制，isBatchingUpdates 不设置为 true。</p> <h2 id="调用-setstate-之后发生了什么"><a href="#调用-setstate-之后发生了什么" class="header-anchor">#</a> 调用 setstate 之后发生了什么？</h2> <p>在代码中调用 setState 函数之后，React 会将传入的参数对象与组件当前的状态合并，然后触发所谓的调和过程（Reconciliation）。经过调和过程，React 会以相对高效的方式根据新的状态构建 React 元素树并且着手重新渲染整个 UI 界面。在 React 得到元素树之后，React 会自动计算出新的树与老树的节点差异，然后根据差异对界面进行最小化重渲染。在差异计算算法中，React 能够相对精确地知道哪些位置发生了改变以及应该如何改变，这就保证了按需更新，而不是全部重新渲染。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/6/18 下午6:18:50</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/react/生命周期.html" class="prev">
        react 的生命周期
      </a></span> <span class="next"><a href="/notes/react/调用super的目的.html">
        (在构造函数中)调用 super(props) 的目的是什么?
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
<script src="/notes/assets/js/app.9a2b2637.js" defer></script><script src="/notes/assets/js/2.d2004554.js" defer></script><script src="/notes/assets/js/8.e6f27235.js" defer></script>
</body>
</html>
